"use strict";var baseUrl="";angular.module("dominionFrontendApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/games/:game",{templateUrl:"views/game.html",controller:"GameCtrl",resolve:{game:["$route","$resource","$q",function(a,b,c){var d=c.defer(),e=b(baseUrl+"/dominion/:gameId"),f=a.current.params.game;return e.get({gameId:f},function(a){d.resolve(a)}),d.promise}],playerId:function(){return null}}}).when("/games/:game/players/:player",{templateUrl:"views/game.html",controller:"GameCtrl",resolve:{game:["$route","$resource","$q",function(a,b,c){var d=c.defer(),e=b(baseUrl+"/dominion/:gameId"),f=a.current.params.game;return e.get({gameId:f},function(a){d.resolve(a)}),d.promise}],playerId:["$route",function(a){return a.current.params.player}]}}).otherwise({redirectTo:"/"})}]).config(["$resourceProvider",function(a){a.defaults.stripTrailingSlashes=!1}]),angular.module("dominionFrontendApp").controller("MainCtrl",["$scope","$http","$resource","$route",function(a,b,c,d){var e="",f=c(e+"/dominion/");a.games=[],a.getGames=function(){return b.get(e+"/dominion/").success(function(b){a.games=b})},a.createGame=function(){var b=new f({});b.$save(a.getGames,d.reload)},a.getGames()}]),angular.module("dominionFrontendApp").controller("GameCtrl",["$scope","$http","$resource","$route","$interval","game","playerId",function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o="",p=f.id;a.game=f,g&&(h=a.player=f.players[g],i=a.hand=f.players[g].hand,j=a.deck=f.players[g].deck,k=a.turn=f.players[g].currentTurn,m=a.discard=f.players[g].discard,l=a.play=f.turn.play),a.test=!1;var q=function(a,b){var c=f.kingdom.cardMarket[a][0],d=f.kingdom.cardMarket[b][0];return c.kingdomSortOrder==d.kingdomSortOrder?0:c.kingdomSortOrder>d.kingdomSortOrder?1:-1},r=function(a,b){var c=f.kingdom.cardMarket[a][0],d=f.kingdom.cardMarket[b][0];return c.cost.money==d.cost.money?0:c.cost.money>d.cost.money?1:-1};a.shuffle=function(){var a=c(o+"/dominion/:gameId/:playerId/shuffle");a.get({gameId:f.id,playerId:g},function(){t()})},a.drawHand=function(){var a=c(o+"/dominion/:gameId/:playerId/draw");a.get({gameId:f.id,playerId:g},function(){t()})},a.discardHand=function(){var a=c(o+"/dominion/:gameId/:playerId/discard");a.get({gameId:f.id,playerId:g},t)},a.canAfford=function(a){return h&&f.turn.money>=a.cost.money},a.purchase=function(a){var b=c(o+"/dominion/:gameId/:playerId/purchase"),d=new b(a);d.$save({gameId:f.id,playerId:g},t)},a.playCard=function(a){var b=c(o+"/dominion/:gameId/:playerId/play"),d=new b(a);d.$save({gameId:f.id,playerId:g},t)},a.nextPhase=function(a){var b=c(o+"/dominion/:gameId/next-phase"),d=new b(a);d.$save({gameId:f.id},t)},a.choose=function(a,b,d,e){var f=c(o+"/dominion/:gameId/:playerId/choice"),g=new f;switch(g.targetChoice=d.id,d.expectedAnswerType){case"CARD":g.card=e;break;case"YES_OR_NO":g.isYesOrNo=e}"CARD"==d.expectedAnswerType,g.$save({gameId:a.id,playerId:b.id},t)},a.chooseDone=function(a,b,d){var e=c(o+"/dominion/:gameId/:playerId/choice"),f=new e;f.targetChoice=d.id,f.done=!0,f.$save({gameId:a.id,playerId:b.id},t)},a.isCurrentPlayer=function(a){return a.id===g},a.isActivePlayer=function(a){return f.turn.playerId===a.id},a.hasCurrentPlayer=function(){return f&&f.players&&f.players.hasOwnProperty(g)},a.getCurrentPlayer=function(){return a.hasCurrentPlayer()?a.game.players[g]:void 0},a.hasCardType=function(a,b){b.cardTypes.includes(a)},a.getChoices=function(){return a.getCurrentPlayer().choices},a.getImagePath=function(a){return a&&a.name?"/images/"+a.name.toLowerCase().replace(/\s/g,"")+".jpg":"/images/empty-card-back.jpg"};var s=function(b){h=a.player=b.players[g],i=a.hand=b.players[g].hand,j=a.deck=b.players[g].deck,k=a.turn=b.players[g].currentTurn,m=a.discard=b.players[g].discard,l=a.play=b.turn.play,a.commonCards=Object.keys(b.kingdom.cardMarket).filter(function(a){return!b.kingdom.cardMarket[a][0].isKingdom}).sort(q),a.kingdomCards=Object.keys(b.kingdom.cardMarket).filter(function(a){return b.kingdom.cardMarket[a][0].isKingdom}).sort(r),u()},t=function(){var a=c(o+"/dominion/:gameId");a.get({gameId:p},function(a){s(a,g)})},u=function(){!n&&h&&"WAITING_FOR_OPPONENT"===h.currentTurn.phase?n=e(function(){t(p)},1e3):n&&"WAITING_FOR_OPPONENT"!==h.currentTurn.phase&&(e.cancel(n),n=void 0)};s(f),u()}]);