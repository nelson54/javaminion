"use strict";var baseUrl="";angular.module("dominionFrontendApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",resolve:{baseUrl:function(){return baseUrl},recommendedCards:["$q","$http",function(a,b){var c=a.defer();return b.get(baseUrl+"/dominion/recommended").success(function(a){c.resolve(a)}),c.promise}]}}).when("/games/:game",{templateUrl:"views/game.html",controller:"GameCtrl",resolve:{game:["$route","$resource","$q",function(a,b,c){var d=c.defer(),e=b(baseUrl+"/dominion/:gameId"),f=a.current.params.game;return e.get({gameId:f},function(a){d.resolve(a)}),d.promise}],playerId:function(){return null},baseUrl:function(){return baseUrl}}}).when("/games/:game/players/:player",{templateUrl:"views/game.html",controller:"GameCtrl",resolve:{game:["$route","$resource","$q",function(a,b,c){var d=c.defer(),e=b(baseUrl+"/dominion/:gameId"),f=a.current.params.game;return e.get({gameId:f},function(a){d.resolve(a)}),d.promise}],playerId:["$route",function(a){return a.current.params.player}],baseUrl:function(){return baseUrl}}}).otherwise({redirectTo:"/"})}]).config(["$resourceProvider",function(a){a.defaults.stripTrailingSlashes=!1}]),angular.module("dominionFrontendApp").controller("MainCtrl",["$scope","$http","$resource","$route","baseUrl","recommendedCards",function(a,b,c,d,e,f){var g=c(e+"/dominion/");a.games=[],a.recommendedCards=f,a.getGames=function(){return b.get(e+"/dominion/").success(function(b){a.games=b})},a.createGame=function(){var b=new g({cardSet:a.cardSet});b.$save(b,d.reload)},a.getGames()}]),angular.module("dominionFrontendApp").controller("GameCtrl",["$scope","$http","$resource","$route","$timeout","game","playerId","baseUrl",function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q=f.id;a.test=!1,a.game=f;var r=function(){!j||"WAITING_FOR_OPPONENT"!==j.currentTurn.phase&&"WAITING_FOR_CHOICE"!==j.currentTurn.phase||e(function(){t(q)},1e3)},s=function(b){i=a.players=b.players,g&&(j=a.player=b.players[g],k=a.hand=b.players[g].hand,l=a.deck=b.players[g].deck,m=a.turn=b.players[g].currentTurn,o=a.discard=b.players[g].discard,n=a.play=b.turn.play,b.players[g]&&b.players[g].choices&&(p=a.choice=b.players[g].choices[0]));var c=function(a,c){var d=b.kingdom.cardMarket[a][0],e=b.kingdom.cardMarket[c][0];return d.kingdomSortOrder==e.kingdomSortOrder?0:d.kingdomSortOrder>e.kingdomSortOrder?1:-1},d=function(a,c){var d=b.kingdom.cardMarket[a][0],e=b.kingdom.cardMarket[c][0];return d.cost.money==e.cost.money?0:d.cost.money>e.cost.money?1:-1};a.commonCards=[],Object.keys(b.kingdom.cardMarket).filter(function(a){return!b.kingdom.cardMarket[a][0].isKingdom}).sort(c).forEach(function(a){kingdomCards[a]=b.kingdom.cardMarket[a]}),a.kingdomCards={},Object.keys(b.kingdom.cardMarket).filter(function(a){return b.kingdom.cardMarket[a][0].isKingdom}).sort(d).forEach(function(a){kingdomCards[a]=b.kingdom.cardMarket[a]}),r()};a.shuffle=function(){var a=c(h+"/dominion/:gameId/:playerId/shuffle");a.get({gameId:f.id,playerId:g},function(a){s(a)})},a.drawHand=function(){var a=c(h+"/dominion/:gameId/:playerId/draw");a.get({gameId:f.id,playerId:g},s)},a.discardHand=function(){var a=c(h+"/dominion/:gameId/:playerId/discard");a.get({gameId:f.id,playerId:g},s)},a.canAfford=function(a){return j&&m.money>=a.cost.money},a.purchase=function(a){var b=c(h+"/dominion/:gameId/:playerId/purchase"),d=new b(a);d.$save({gameId:f.id,playerId:g},s)},a.playCard=function(a){var b=c(h+"/dominion/:gameId/:playerId/play"),d=new b(a);d.$save({gameId:f.id,playerId:g},s)},a.nextPhase=function(a){var b=c(h+"/dominion/:gameId/next-phase"),d=new b(a);d.$save({gameId:f.id},s)},a.choose=function(a,b,d,e){var f=c(h+"/dominion/:gameId/:playerId/choice"),g=new f;switch(g.targetChoice=d.id,d.expectedAnswerType){case"CARD":g.card=e;break;case"YES_OR_NO":g.isYesOrNo=e}"CARD"==d.expectedAnswerType,g.$save({gameId:a.id,playerId:b.id},s)},a.chooseDone=function(a,b,d){var e=c(h+"/dominion/:gameId/:playerId/choice"),f=new e;f.targetChoice=d.id,f.done=!0,f.$save({gameId:a.id,playerId:b.id},s)},a.isCurrentPlayer=function(a){return a.id===g},a.isActivePlayer=function(a){return g===a.id},a.hasCurrentPlayer=function(){return f&&f.players&&f.players.hasOwnProperty(g)},a.getCurrentPlayer=function(){return a.hasCurrentPlayer()?i[g]:void 0},a.hasCardType=function(a,b){b.cardTypes.includes(a)},a.getChoices=function(){return a.getCurrentPlayer().choices},a.getImagePath=function(a){return a&&a.name?"/images/"+a.name.toLowerCase().replace(/\s/g,"")+".jpg":"/images/empty-card-back.jpg"},a.isCardInPlay=function(a){return Object.keys(n).map(function(a){n[a].id}).indexOf(a.id)<0};var t=function(){var a=c(h+"/dominion/:gameId");a.get({gameId:q},function(a){s(a,g)})};s(f)}]);